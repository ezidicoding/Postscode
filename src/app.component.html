
<div class="app-container flex flex-col h-screen max-w-2xl mx-auto bg-white shadow-lg">

  <!-- Header -->
  <header class="flex items-center p-4 gap-4 flex-shrink-0 border-b border-slate-200">
    <img src="https://upload.wikimedia.org/wikipedia/commons/5/56/%C3%8Az%C3%AAdxan_Protection_Force.svg" alt="Profile" class="w-10 h-10 rounded-lg object-cover">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Flag_of_Kurdistan.svg/1200px-Flag_of_Kurdistan.svg.png" alt="Profile" class="w-10 h-10 rounded-lg object-cover">
    <h1 class="text-xl font-semibold text-slate-800 mr-auto">GoTranslate</h1>
    <button (click)="openModal()" class="text-2xl text-slate-500 hover:text-amber-500 transition-colors" aria-label="Open saved phrases">
      <i class="fa-solid fa-star"></i>
    </button>
  </header>

  <!-- Main Content -->
  <main class="flex-grow p-1 md:p-4 flex flex-col">
    <div class="text-area-container flex-grow flex flex-col rounded-xl border border-slate-200">
      
      <!-- Source Text Area -->
      <div class="source-wrapper relative flex-1 flex flex-col p-4">
        <textarea 
          [value]="sourceText()"
          (input)="onSourceTextInput($event)"
          id="source-text"
          placeholder="إدخال نص"
          class="w-full flex-grow border-none outline-none bg-transparent resize-none text-2xl md:text-3xl placeholder-slate-400"
          [class.text-left]="isSourceYezidiCkb()"
          [class.text-right]="!isSourceYezidiCkb()"
        ></textarea>
        @if (!sourceText()) {
          <button (click)="pasteText()" class="absolute bottom-4 left-4 flex items-center gap-2 px-4 py-2 bg-slate-100 rounded-full text-sky-600 font-semibold text-sm hover:bg-slate-200 transition-colors">
            <i class="fa-regular fa-paste"></i>
            <span>لصق</span>
          </button>
        }
        @if (sourceText()) {
          <button (click)="speakText(sourceText(), sourceLang())" class="absolute top-4 left-4 text-slate-500 hover:text-sky-600 transition-colors" aria-label="Speak source text">
            <i class="fa-solid fa-volume-high"></i>
          </button>
        }
      </div>

      <div class="h-8 text-center text-slate-500 text-sm py-1">{{ status() }}</div>

      <!-- Translated Text Area -->
      <div class="translated-wrapper relative flex-1 flex flex-col p-4 border-t border-slate-200 min-h-[120px] bg-slate-50/50">
        <div id="translated-text" class="w-full flex-grow bg-transparent text-2xl md:text-3xl text-slate-800 pt-2 text-right">
            {{ translatedText() }}
        </div>
        @if (translatedText() && translatedText() !== '...') {
            <div class="absolute top-4 left-4 flex items-center gap-4">
                <button (click)="toggleFavorite()" [class.text-amber-500]="isCurrentTranslationSaved()" class="text-slate-500 hover:text-amber-500 transition-colors text-xl" aria-label="Favorite this translation">
                    <i class="fa-star" [class.fa-solid]="isCurrentTranslationSaved()" [class.fa-regular]="!isCurrentTranslationSaved()"></i>
                </button>
                <button (click)="speakText(translatedText(), targetLang())" class="text-slate-500 hover:text-sky-600 transition-colors" aria-label="Speak translated text">
                    <i class="fa-solid fa-volume-high"></i>
                </button>
            </div>
        }
      </div>
    </div>
  </main>

  <!-- Language Selector -->
  <div class="language-selector flex items-center gap-2 p-4 flex-shrink-0">
    <div class="lang-container flex-1">
      <select [value]="sourceLang()" (change)="onSourceLangChange($event)" class="lang-btn w-full bg-white border border-slate-300 rounded-full px-4 py-2.5 text-slate-700 font-medium text-center cursor-pointer appearance-none">
        @for(lang of languages; track lang.code) {
          <option [value]="lang.code">{{ lang.name }}</option>
        }
      </select>
    </div>
    <button (click)="swapLanguages()" class="p-2 text-slate-500 hover:text-sky-600 transition-colors" aria-label="Swap languages">
        <i class="fa-solid fa-right-left"></i>
    </button>
    <div class="lang-container flex-1">
      <select [value]="targetLang()" (change)="onTargetLangChange($event)" class="lang-btn w-full bg-white border border-slate-300 rounded-full px-4 py-2.5 text-slate-700 font-medium text-center cursor-pointer appearance-none">
        @for(lang of languages; track lang.code) {
          <option [value]="lang.code">{{ lang.name }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Footer Actions -->
  <footer class="flex justify-around items-center p-2 pb-4 flex-shrink-0 bg-slate-100/80 border-t border-slate-200">
    <div class="action-item flex flex-col items-center gap-1 text-center cursor-pointer" (click)="alert('ميزة الكاميرا غير متاحة حاليًا.')">
      <div class="icon-wrapper w-12 h-12 rounded-full flex justify-center items-center text-slate-700 text-xl bg-slate-200/80"><i class="fa-solid fa-camera-retro"></i></div>
      <p class="text-xs text-slate-600">الكاميرا</p>
    </div>
    <div class="action-item">
      <button (click)="toggleListening()" class="icon-wrapper w-16 h-16 rounded-full flex justify-center items-center text-white text-2xl transition-colors shadow-lg" [class.bg-red-500]="isListening()" [class.mic-listening]="isListening()" [class.bg-sky-500]="!isListening()">
        <i class="fa-solid fa-microphone"></i>
      </button>
    </div>
    <div class="action-item flex flex-col items-center gap-1 text-center cursor-pointer" (click)="alert('ميزة المحادثة غير متاحة حاليًا.')">
      <div class="icon-wrapper w-12 h-12 rounded-full flex justify-center items-center text-slate-700 text-xl bg-slate-200/80"><i class="fa-solid fa-users"></i></div>
      <p class="text-xs text-slate-600">محادثة</p>
    </div>
  </footer>
</div>

<!-- Saved Phrases Modal -->
@if (isModalOpen()) {
  <div class="saved-words-modal-overlay fixed inset-0 bg-black/50 flex justify-center items-center z-50" (click)="closeModal()">
    <div class="saved-words-modal-content bg-white rounded-2xl w-[90%] max-w-md max-h-[80%] flex flex-col shadow-2xl" (click)="$event.stopPropagation()">
      <div class="saved-words-modal-header flex justify-between items-center p-4 border-b border-slate-200">
        <h2 class="text-lg font-semibold text-slate-800">العبارات المحفوظة</h2>
        <button (click)="closeModal()" class="text-2xl text-slate-400 hover:text-slate-600 transition-colors">
          <i class="fa-solid fa-times"></i>
        </button>
      </div>
      <ul class="saved-words-list list-none p-0 m-0 overflow-y-auto flex-grow">
        @if (savedPhrases().length > 0) {
          @for (phrase of savedPhrases(); track phrase.id) {
            <li class="flex flex-col p-4 border-b border-slate-100 last:border-b-0">
              <p class="phrase-text font-semibold text-slate-700 mb-1 text-lg text-right">{{ phrase.translatedText }}</p>
              <p class="original-text text-sm text-slate-500 mb-2 text-right">
                {{ phrase.originalText }} ({{ getLangName(phrase.sourceLang) }} -> {{ getLangName(phrase.targetLang) }})
              </p>
              <div class="flex justify-end">
                <button (click)="deletePhrase(phrase.id)" class="bg-red-500 text-white rounded-md px-3 py-1 text-xs font-semibold hover:bg-red-600 transition-colors">
                  حذف
                </button>
              </div>
            </li>
          }
        } @else {
          <p class="text-center text-slate-500 p-8">لا توجد عبارات محفوظة بعد.</p>
        }
      </ul>
    </div>
  </div>
}
